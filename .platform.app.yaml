name: app

type: php:8.2

build:
    flavor: composer

hooks:
    build: |
        composer install --no-dev --prefer-dist --no-scripts --no-interaction

    deploy: |
        composer run-script post-install-cmd --no-dev --no-interaction
        php bin/console doctrine:migrations:migrate --no-interaction
        php bin/console cache:clear

runtime:
    extensions:
        - pdo_mysql

web:
    commands:
        start: php -S 0.0.0.0:8080 -t public

mounts:
    "/public/uploads": "shared:files"

disk: 512

relationships:
    database: "mysql:mysql"

variables:
    env:
        APP_ENV: "prod"
        APP_SECRET: "changeme"
        DATABASE_URL: "mysql://app:!ChangeMe!@database.internal/app"

